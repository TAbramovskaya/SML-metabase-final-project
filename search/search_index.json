{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Summary","text":""},{"location":"#what-are-we-going-to-do","title":"What are we going to do?","text":"<p>We are going to analyze sales data from a chain pharmacy in Russia. We will use the RFM methodology and accompany our analysis with visualizations in Metabase.</p>"},{"location":"#what-do-we-have","title":"What do we have?","text":"<p>For the analysis, a dataset was provided containing 45 128 transactions recorded between May 1 and June 9, 2022, including detailed information about customer purchases, transaction amounts, and loyalty program identifiers. A full description of the table and field definitions is available on a Source page.</p>"},{"location":"#where-do-we-start","title":"Where do we start?","text":"<p>We will start by examining the data and preparing it for analysis. As a result of the preliminary data processing, the number of transactions included in the analysis will be reduced to 10 256. See a complete overview of the Data preparation steps.   </p>"},{"location":"#what-do-we-want-to-achieve","title":"What do we want to achieve?","text":"<p>We will perform an RFM analysis on the dataset. A set of 2 285 customers will be selected for the analysis, we will assign scores to them according to the RFM methodology and then divide them into segments based on behavioral patterns to work with them more effectively and we will divide them into groups according to the RFM methodology. Proceed directly to the RFM calculation methodology.</p>"},{"location":"data_preprocessing/","title":"Data preprocessing","text":""},{"location":"data_preprocessing/#handling-nulls","title":"Handling NULLs","text":"<p>Participation in the discount program is determined by the loyalty card barcode, recorded in the <code>DR_BCDisc</code> field. For some transactions, this field has the string value <code>'NULL'</code>. It turns out that within a single receipt, some items may be sold with a discount (and the corresponding transaction will include the customer\u2019s barcode number), while other items are sold without a discount \u2014 for these, <code>'NULL'</code> will be recorded in the receipt.</p> <p>Thus, not all transactions with <code>'NULL'</code> in the <code>DR_BCDisc</code> field are unidentifiable; some can still be accounted for using the primary key that identifies the receipt. See a complete analysis of how we are going to treat 'NULL's. </p>"},{"location":"data_preprocessing/#unusual-behaviour-of-certain-barcodes","title":"Unusual behaviour of certain barcodes","text":"<p>We also notice some outliers \u2014 six barcodes account for more than half of all receipts available in the dataset. Take a look at a full analysis of this fact, along with other Unusual behavior of certain barcodes.</p>"},{"location":"data_preprocessing/#inconsistent-data","title":"Inconsistent data","text":"<p>The discount amount is represented as a positive value, which is then subtracted from the cost of the items in the transaction. Therefore, the total cost of goods sold in a single transaction is calculated as: quantity sold \u00d7 retail price \u2013 discount amount (<code>DR_Kol \u00d7 DR_CRoz \u2013 DR_SDisc</code>). Very rarely, we observe negative discounts or negative quantities sold in the data. We will also examine the difference between the wholesale price and the retail price. If there are product groups where the retail price is higher than the wholesale price, these may be items that should be excluded from our analysis. See Inconsistent data overview for more details.</p>"},{"location":"data_preprocessing/#dataset-for-rfm-analysis","title":"Dataset for RFM analysis","text":"<p>Look at the RFM Aggregated data section to explore share of transactions and receipts included in the analysis. Or proceed directly to explore RFM Calculation Methodology. </p>"},{"location":"db_overview/","title":"Source","text":"<p>The analysis will be conducted based on the <code>sales</code> table.</p> <p>The sales table contains the following columns (information on sales):</p> <ul> <li><code>DR_Dat</code> \u2013 purchase date (<code>date</code>, yyyy-mm-dd)</li> <li><code>DR_Tim</code> \u2013 purchase time (<code>time</code>, hh:mm:ss)</li> <li><code>DR_NChk</code> \u2013 receipt number (<code>integer</code>)</li> <li><code>DR_NDoc</code> \u2013 cash register document number (<code>integer</code>)</li> <li><code>DR_apt</code> \u2013 store ID number (<code>integer</code>)</li> <li><code>DR_Kkm</code> \u2013 cash register ID number (<code>integer</code>)</li> <li><code>DR_TDoc</code> \u2013 type of document (<code>varchar</code>, in the data, this field is always equal to \"\u0420\u043e\u0437\u043d\u0438\u0447\u043d\u0430\u044f \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f\" which means \"retail sale\")</li> <li><code>DR_TPay</code> \u2013 payment type (<code>integer</code>, 18 = cashless, 15 = cash)</li> <li><code>DR_CDrugs</code> \u2013 product code (<code>integer</code>)</li> <li><code>DR_NDrugs</code> \u2013 product name (<code>varchar</code>)</li> <li><code>DR_Suppl</code> \u2013 supplier (<code>varchar</code>)</li> <li><code>DR_Prod</code> \u2013 manufacturer (<code>varchar</code>)</li> <li><code>DR_Kol</code> \u2013 quantity sold (<code>double precision</code>)</li> <li><code>DR_CZak</code> \u2013 wholesale price (<code>double precision</code>)</li> <li><code>DR_CRoz</code> \u2013 retail price (<code>double precision</code>)</li> <li><code>DR_SDisc</code> \u2013 discount amount (<code>double precision</code>)</li> <li><code>DR_CDisc</code> \u2013 discount code (<code>text</code>)</li> <li><code>DR_BCDisc</code> \u2013 discount barcode (<code>text</code>)</li> <li><code>DR_TabEmpl</code> \u2013 employee ID (<code>integer</code>)</li> <li><code>DR_Pos</code> \u2013 item position in the receipt (<code>integer</code>)</li> <li><code>DR_VZak</code> \u2013 type of purchase (<code>integer</code>, 1 = regular, 2 = online order)</li> </ul> <p>The primary key in the sales table is the combination of fields <code>(DR_Dat, DR_Tim, DR_NChk, DR_NDoc, DR_apt, DR_Kkm, DR_TabEmpl, DR_Pos)</code>. </p> <p>When a customer with a discount card (<code>DR_BCDisc</code>) makes a purchase, multiple entries are added to the table \u2014 one for each unique product name (defined by <code>DR_CDrugs</code> and <code>DR_NDrugs</code>) \u2014 all sharing the same key tuple values except for the last one, <code>DR_Pos</code>, which indicates the sequential number of the item within the receipt.</p> <p>The discount amount is applied once to the total cost of the specified item for the entire quantity purchased, that is, the cost of goods within a transaction including the discount is calculated as <code>DR_CRoz \u00d7 DR_Kol \u2013 DR_SDisc</code> (retail price\u00d7quantity sold - discount amount).</p>"},{"location":"frequency_study/","title":"Frequency","text":""},{"location":"frequency_study/#split-into-equal-parts","title":"Split into equal parts","text":"<p>Let\u2019s take a look at how the score boundaries for frequency were determined when dividing customers into three equal groups. </p> f_score group_size min_frequency max_frequency 1 762 2 36 2 762 1 2 3 761 1 1 <p>When dividing customers into three equal groups, Group 1 ended up with customers whose visit frequency varied too widely. We also see that most customers visit the pharmacy once or twice, a single visit appears in both Groups 2 and 3, and two visits fall into Groups 1 and 2. </p> <p>We can assume that pharmacies are mainly used by nearby residents, and in most large cities, several pharmacies are located within walking distance. Choosing a pharmacy is therefore determined not only by lower prices, but also by personal preference. Older customers tend to stick with familiar services rather than trying new ones; they may also prefer to discuss sensitive health-related questions with pharmacy staff they know, rather than going to a new location.</p>"},{"location":"frequency_study/#our-choice","title":"Our choice","text":"<p>We will treat Group 3 as customers who visited the pharmacy only once. These can be either new customers using the loyalty card for the first time, or customers who rarely visit the pharmacy (for example, younger customers).</p> <p>We will assign customers who visit the pharmacy two or three times to Group 2 \u2014 these may be customers who take certain medications on a daily basis and therefore require regular pharmacy visits, or simply customers who already prefer our pharmacy when they need certain products.</p> <p>Group 1 will include customers with 4 to 6 visits \u2014 within a six-week period this corresponds to weekly pharmacy visits. These may be, for example, young parents (small children often require special medications or baby products available in pharmacies), as well as older customers who visit pharmacies several times a month.</p> <p>Finally, Group 0 includes customers with more than 7 visits (the median for this group is 9 visits). Such visitors \u2014 assuming they are genuine customers and not barcodes we could not classify as for internal use \u2014 could be habitual customers who show a level of emotional attachment to the store or customers who truly need many medications.</p> f_score group_size min_frequency max_frequency 0 29 7 36 1 111 4 6 2 713 2 3 3 1432 1 1"},{"location":"frequency_study/#sql-verification","title":"SQL Verification","text":"<p>All the SQL queries used in this section are available in the GitHub repository.</p>"},{"location":"inconsistent_data_overview/","title":"Inconsistent data","text":""},{"location":"inconsistent_data_overview/#exploring-the-data","title":"Exploring the Data","text":"<p>The discount amount is represented as a positive value, which is then subtracted from the cost of the items in the transaction. Therefore, the total cost of goods sold in a single transaction is calculated as: quantity sold \u00d7 retail price \u2013 discount amount (<code>DR_Kol \u00d7 DR_CRoz \u2013 DR_SDisc</code>). </p> <p>Among all transactions, only five have either a negative quantity or a negative discount amount. There are no transactions with negative prices.</p> date receipt_id quantity_sold discount_amount barcode 2022-05-03 6381 1 -0.01 NULL 2022-05-17 6405 -1 -102 NULL 2022-05-18 195 -1 0 NULL 2022-05-20 463 -1 0 NULL 2022-05-29 2641 -1 -470 NULL <p>Among these orders, those with a negative quantity <code>-1</code>, the corresponding receipts consist of a single item, and the loyalty card is recorded as <code>'NULL'</code>. In transactions with a positive quantity but a negative discount, barcode <code>200000000492</code> is used, which we exclude from our analysis (see unusual_behavior) overview.</p> <p>A negative retail markup occurs only for a single product, \"Loyalty Card.\"</p> product_name retail_price wholesale_price discount_amount discount_barcode \u041a\u0430\u0440\u0442\u0430 LOYALITY 25\u0420 25 59.67 0 NULL <p>Presumably, purchasing this item through retail is one way to start using the benefits of the loyalty program. Therefore, it\u2019s not surprising that these transactions are associated only with <code>'NULL'</code> receipts. </p>"},{"location":"inconsistent_data_overview/#our-actions","title":"Our Actions","text":"<p>No further actions or decisions are required regarding this issue.</p>"},{"location":"inconsistent_data_overview/#sql-verification","title":"SQL Verification","text":"<p>You can check the GitHub repository to review the SQL queries used in this section.</p>"},{"location":"monetary_study/","title":"Monetary","text":""},{"location":"monetary_study/#split-into-equal-parts","title":"Split into equal parts","text":"<p>Let\u2019s take a look at how the score boundaries for monetary were determined when dividing customers into three equal groups.</p> m_score group_size min_monetary max_monetary 1 762 1123 32058 2 762 389 1122 3 761 24 388 <p>The median monetary value is 659 RUB, average \u2014 745.5 RUB. We can see that the highest spending values differ from the median by two orders of magnitude.</p>"},{"location":"monetary_study/#some-research","title":"Some research","text":"<p>We will rely on publicly available research from the analytical company RNC Pharma. According to their analysis (see the RNC Pharma report on seasonal sales, pdf, in Russian), the monthly per capita consumption of medications in 2023 and 2024 was over 800 RUB and 930 RUB, respectively. </p> <p></p> <p>Note that RNC Pharma analysts distinguish between purchases of medicines and non-medicinal products offered by pharmacies (parapharmaceuticals: cosmetics, food supplements, etc.). So an additional approximately 200 RUB comes from parapharmaceutical consumption. We do not have data for 2022, however, the same report shows the revenue structure for 2022.</p> <p></p> <p>Based on the trend, we can estimate that the monthly per capita consumption of medications in 2022 was around 760 RUB, thus, including parapharmaceuticals, the monthly per capita consumption would be around 960 RUB.</p> <p>Our analysis includes only actual customers (not the entire population), however, our period falls within a season of traditionally low pharmacy sales.</p> <p></p> <p>We can see that our average monthly spending of 745.5 RUB differs significantly from what we could estimate based on the report of monthly per capita spending. There are several possible reasons for this. First, it is a low season \u2014 we see that May-July is a period of minimal sales. Second, consumption levels can vary greatly across different regions of Russia, and we do not know which regions the pharmacies in our dataset belong to. Third, our data may be incomplete.</p>"},{"location":"monetary_study/#our-choice","title":"Our choice","text":"<p>The period selected for data analysis is slightly longer than a month, but under all other assumptions, this should not have a significant impact. We will set a threshold of 5 000 RUB as the lower boundary for   Group 0 (this corresponds to the largest banknote in Russia and serves more as a psychological barrier than a data-driven value). According to the reasoning above, the range from 650 to 1050 RUB will be considered the spending limits of a \"regular customer\"; above this amount \u2014 customers with higher medication needs, below \u2014 customers with lower medication needs.</p> m_score group_size min_monetary max_monetary 0 85 5014 32058 1 728 1053 4995 2 339 650 1050 3 1133 24 649"},{"location":"monetary_study/#sql-verification","title":"SQL Verification","text":"<p>All the SQL queries used in this section are available in the GitHub repository.</p>"},{"location":"null_barcodes_overview/","title":"Handling NULLs","text":""},{"location":"null_barcodes_overview/#exploring-the-data","title":"Exploring the Data","text":"<p>We are examining how customer cards are represented in the <code>DR_BCDisc</code> column. We calculate how many transactions correspond to <code>'NULL'</code> barcodes and how many to valid barcodes (any string entries other than <code>'NULL'</code> are treated as valid barcode identifiers). Let\u2019s also make sure that all cards are either marked with the string <code>'NULL'</code> or have some other string value, and that there are no SQL <code>null</code> among them.</p> <p></p> <p>Thus, we have 17 936 valid transactions, 27 192 <code>'NULL'</code>-string entries, and no transactions with an actual SQL <code>null</code> value.</p> <p>The distribution of valid and invalid transactions within a single day appears consistent with the overall 40/60 ratio observed across the entire table. (May 9 is a public holiday in Russia, and many stores are closed on that day.)</p> <p></p> <p>Let\u2019s examine how many distinct receipts are present in the data in total; how many of them include a valid loyalty card and how many contain a <code>'NULL'</code> barcode. </p> <p></p> <p>We see that the sum of valid and <code>'NULL'</code> receipts does not equal the Total. This means that some receipts contain both items purchased with a valid loyalty card and items for which no discount was applied.</p> <p>We can assume that certain product categories are not eligible for discounts. Take a look at one of these receipts as an example.</p> Click to view a receipt receipt position card price discount drug_code drug_name 2297 1 NULL 395 0 4260 \u0412\u0418\u0411\u0420\u041e\u0426\u0418\u041b 15\u041c\u041b. 2297 2 NULL 455 0 76754 \u0420\u0415\u041d\u041d\u0418 \u211624 \u0422\u0410\u0411.\u0416 2297 3 200000000024 259 25 83115 \u0420\u041e\u041a\u0421 \u0417\u0423\u0411.\u041f\u0410\u0421\u0422\u0410 2297 4 200000000024 256 25 27561 \u0420\u041e\u041a\u0421 \u0417\u0423\u0411.\u041f\u0410\u0421\u0422\u0410 2297 5 NULL 121 0 72392 \u0421\u041d\u0423\u041f 0,1% 90\u041c\u041a\u0413 2297 6 NULL 121 0 72392 \u0421\u041d\u0423\u041f 0,1% 90\u041c\u041a\u0413 2297 7 NULL 446 0 31 \u0422\u0410\u041d\u0422\u0423\u041c \u0412\u0415\u0420\u0414\u0415 0,"},{"location":"null_barcodes_overview/#our-actions","title":"Our Actions","text":"<p>We will merge the information according to the primary key so that each receipt contains data for all its items.</p> <p>Receipts that contain only <code>'NULL'</code> barcodes cannot be associated with any customer, therefore, we will exclude them from the analysis.</p>"},{"location":"null_barcodes_overview/#sql-verification","title":"SQL Verification","text":"<p>You can check the GitHub repository to review the SQL queries used in this section.</p>"},{"location":"recency_study/","title":"Recency","text":""},{"location":"recency_study/#split-into-equal-parts","title":"Split into equal parts","text":"<p>Let\u2019s take a look at how the score boundaries for recency were determined when dividing customers into three equal groups.</p> r_score group_size min_recency max_recency 1 762 0 9 2 762 9 21 3 761 21 39 <p>One third of the users made their most recent purchase no more than 10 days before the final date in the dataset. We have a six-week observation window, during which more than two thirds of all customers made their last purchase in the second half of the period. </p>"},{"location":"recency_study/#our-choice","title":"Our choice","text":"<p>We will keep this grouping but make the boundaries more precise so that customers with the same recency value do not end up in different groups. We set the upper bounds at 8 days and 21 days for Groups 1 and 2, respectively. Now, over the 40-day period, more than two thirds of all customers visited the pharmacy during the latter half of that time.</p> <p>Final grouping by recency:</p> r_score group_size min_recency max_recency 1 736 0 8 2 803 9 21 3 746 22 39 <p>Note</p> <p>It should be noted that over the six-week period, during which more than half of the customers visited only once, the recency metric is not very informative. We will see that groups with the same frequency and monetary values (regardless of recency) demonstrate remarkable consistency.</p>"},{"location":"recency_study/#sql-verification","title":"SQL Verification","text":"<p>All the SQL queries used in this section are available in the GitHub repository.</p>"},{"location":"rfm_aggregated_data/","title":"RFM aggregated data","text":"<p>To compile a table containing the receipts that will serve as the basis for the RFM analysis, we will first merge all missing <code>'NULL'</code>-transactions into their corresponding receipts, then filter out the barcodes we identified as internal use as well as any receipts whose barcode remained <code>'NULL'</code> after first step.</p> <p>We can check what proportion of receipts will ultimately form the basis for the analysis.</p>"},{"location":"rfm_aggregated_data/#share-of-filtered-receipts","title":"Share of filtered receipts","text":"<p>The RFM analysis will be based on 18.5% of all receipts available in the dataset. This corresponds to 3 886 receipts, representing purchases made by 2 285 customers. </p>"},{"location":"rfm_aggregated_data/#share-of-filtered-transactions","title":"Share of filtered transactions","text":"<p>Compared to the initial dataset, the analysis will be based on 10 256 transactions, which corresponds to slightly less than 22.7% of the entire dataset. </p>"},{"location":"rfm_aggregated_data/#sql-verification","title":"SQL Verification","text":"<p>All the SQL queries used in this section are available in the GitHub repository.</p>"},{"location":"rfm_behavior/","title":"Behavior & Segmentation","text":"<p>For the selected groups, we will additionally calculate the average receipt amount and the average number of items per receipt (within the group).</p> <p>The average receipt (including parapharmaceuticals) in 2022 was 601.8 RUB (see the RNC Pharma blogpost about average one-time purchase in pharmacies in 2022 - 2025, in Russian). </p> <p></p> <p>We also know that in 2025 customers purchased, on average, 2.4\u20133 packages per month (see the RNC Pharma blogpost about average per capita spending on the purchase of medicines, in Russian).</p>"},{"location":"rfm_behavior/#generous-customers","title":"Generous Customers","text":"<p>Let\u2019s start with a group of super performers by average receipt. They are characterized by a low frequency, but a high average receipt (at least three times higher than the 2022 average) and a relatively high number of items per receipt.</p> Click to expand the table rfm average_receipt_total average_number_of_items average_discount group_size 130 12255.25 9 4.99 4 230 6644.33 6.33 4.85 3 330 6006.89 9.89 4.91 9 320 3569.7 6.9 4.32 5 220 3447.65 4.77 4.53 14 120 2639.18 3.81 4.7 15 131 2070.88 3.97 5.05 69 331 1989.12 4.47 5.22 133 231 1984.45 4.61 5.08 82 <p>We can see that groups x30, x31, and x20 (with all possible recency values) fall into this category. The largest share consists of customers in group x31. These appear to be customers who visit the pharmacy due to a particular one-off circumstance (we see large number of items in the receipt), who do not visit often (we see a small group of 34 people who came 2 or 3 times, the rest only once), but who do not economize on medical products when needed. We will call this group the Generous Customers. </p> group_name average_receipt_total average_number_of_items average_discount group_size Generous Customers 2391.88 4.64 5.07 334"},{"location":"rfm_behavior/#outstanding-customers","title":"Outstanding Customers","text":"<p>Next is the group of regular customers with an average receipt above, or even up to an order of magnitude higher than, the 2022 average.</p> Click to expand the table rfm average_receipt_total average_number_of_items average_discount group_size 110 1956.47 3.59 5.82 15 210 1326.93 3.6 5.13 3 321 984.26 2.89 5.16 60 121 962.65 3.14 5.22 164 221 962.37 3.19 5.35 130 <p>Groups x10 and x21 fall into this category (Group 310 is empty). These are our regular customers who visit the pharmacy 2 to 3 times within 6 weeks (18 of them came 4\u20136 times). The frequency of this group shows consistent pharmacy visits. We also observe a high average receipt amount, but unlike the Generous Customers, the average number of items per receipt is below 4. Most likely, they purchase fewer non-medical products.</p> <p>A special note should be made about group x21. </p> rfm average_receipt_total average_number_of_items average_discount group_size x21 966.21 3.11 5.26 354 <p>These are our key customers with high potential. They are willing to spend and demonstrate strong loyalty to the pharmacy. </p> <p>We will also include groups 100 and 200 here (group 300 is empty). They visit the pharmacy very frequently, have a high average receipt amount, and a very high monetary value (over 5,000 rubles). These are customers who live nearby and have high demand for medical products.</p> Click to expand the table rfm average_receipt_total average_number_of_items average_discount group_size 200 906.87 2.71 5.25 4 100 761.04 2.59 5.15 13 <p>We will call this entire group \"Outstanding Customers.\" </p> group_name average_receipt_total average_number_of_items average_discount group_size Outstanding Customers 999.71 3.11 5.28 389"},{"location":"rfm_behavior/#promising-customers","title":"Promising Customers","text":"<p>The next set brings together customers from the x32 groups. These are customers who visited the pharmacy only once but made a purchase with a relatively high average receipt amount. These are Promising Customers whom we would like to bring back to the store. </p> Click to expand the table rfm average_receipt_total average_number_of_items average_discount group_size 332 817.3 2.85 5.27 102 132 812.86 2.3 5.46 37 232 798.92 2.7 5.64 64 <p>We can see that they have a high discount percentage (compare this to the Generous Customers, who also visited only once, but whose discounts were lower or around 5%). This indicates that many of the items in their receipt were discounted, meaning these customers are interested in the promotions and discounts offered by the pharmacy.</p> <p>We will call this group Promising Customers. Together with Generous Customers they form a strong potential to expand the Outstanding group.</p> group_name average_receipt_total average_number_of_items average_discount group_size Promising Customers 810.7 2.7 5.42 203"},{"location":"rfm_behavior/#pharmacy-friends","title":"Pharmacy Friends","text":"<p>Next, we will identify a group of customers who visit us regularly. Their average receipt amount is small, but they show medium or high monetary values. </p> Click to expand the table rfm average_receipt_total average_number_of_items average_discount group_size 111 623.27 2.63 5.96 52 311 580.14 1.8 5.37 5 211 575.81 2.55 5.71 21 101 469.49 2.25 5.31 11 322 390.94 2.58 4.97 27 222 374.12 2.55 5.16 53 122 352.81 2.34 5.66 47 201 292.86 1.86 7.25 1 <p>They also tend to purchase discounted items. </p> group_name average_receipt_total average_number_of_items average_discount group_size Pharmacy Friends 460.03 2.49 5.51 217"},{"location":"rfm_behavior/#neighborhood-customers","title":"Neighborhood Customers","text":"<p>The next group demonstrates ordinary, need-based use of the pharmacy. We will call this group Neighborhood Customers.</p> Click to expand the table rfm average_receipt_total average_number_of_items average_discount group_size 212 231.75 2.75 6.61 1 112 207.31 1.5 4.4 8 223 192.63 1.75 5.2 77 123 190.07 1.81 5.07 85 323 189.3 1.71 5.14 36 313 149.25 1.5 6.57 1 113 122.3 1.57 5.34 3 213 112.75 1.63 5.95 2 <p>These customers most likely find it convenient to visit this pharmacy; the majority of them came in no more than three weeks ago, and they probably do not have a consistent need for medicinal products. </p> group_name average_receipt_total average_number_of_items average_discount group_size Neighborhood Customers 189.83 1.76 5.13 213"},{"location":"rfm_behavior/#interested-visitors","title":"Interested Visitors","text":"<p>The final group is a large one of one-time visitors who popped in for a pack of paracetamol or ibuprofen.</p> Click to expand the table rfm average_receipt_total average_number_of_items discount group_size 333 280.04 1.96 4.95 436 233 275.43 2.1 5 280 133 269.4 1.91 4.86 213 <p>Nevertheless, they agreed to buy a loyalty card, so we will call this group the Interested Visitors.</p> group_name average_receipt_total average_number_of_items average_discount group_size Interested Visitors 276.21 1.99 4.94 929"},{"location":"rfm_behavior/#sql-verification","title":"SQL Verification","text":"<p>All the SQL queries used in this section are available in the GitHub repository for review and verification.</p>"},{"location":"rfm_calculation_methodology/","title":"RFM calculation methodology","text":"<p>Our goal is to divide the 2,285 customers into groups according to the RFM methodology, and then consolidate them into larger segments based on behavioral patterns. As a result of our work, we will obtain 6 major segments. The methods for working with the recency, frequency, and monetary metrics are presented below.</p> <p></p> <p>Let\u2019s define the methodology and the labeling format for assigning users to groups.</p>"},{"location":"rfm_calculation_methodology/#recency","title":"Recency","text":"<p>How recently did a customer make a purchase? Since we are working with a limited dataset, we will treat the last day in the dataset as the zero point for recency. For each customer, we will determine the minimum number of days between their purchases and this date. We use a smaller group number for more recent activity (any customer from Group 1 made his/her most recent purchase after any customer from Group 3). Analysis and grouping in the Recency section. And here is what we will get as a result:</p> <p></p>"},{"location":"rfm_calculation_methodology/#frequency","title":"Frequency","text":"<p>How often does a customer buy? Multiple receipts on the same day are very rare (among regular customers, only 91 made two or more purchases in a single day). Therefore, we will measure purchase frequency based on the number of receipts rather than the number of calendar days. We use a smaller group number for higher frequency (Group 1 uses the store more often than Group 3). See the Frequency section. These will be the scoring outcomes for Frequency:</p> <p></p>"},{"location":"rfm_calculation_methodology/#monetary","title":"Monetary","text":"<p>How much does a customer spend? We will review publicly available research from the analytical company RNC Pharma to determine which monetary values should be considered \"average\" and use them to define the boundaries between the groups. We use a smaller group number for users with larger purchases (Group 1 spends more than Group 3). Continued in the Monetary section. The scores for Monetary will look like this:</p> <p></p>"},{"location":"rfm_calculation_methodology/#grouping","title":"Grouping","text":"<p>Now we\u2019re ready to analyze the Behavior of the resulting segments. </p>"},{"location":"rfm_finalize/","title":"Insights & Recommendations","text":""},{"location":"rfm_finalize/#recommendations-for-better-data","title":"Recommendations for Better Data","text":"<p>We will begin with recommendations regarding the quality of the data provided for analysis.</p> <p>First, a longer period of around three months seems more suitable for the transaction flow we observed. With the shorter period we had, the Recency metric became almost non-informative.</p> <p>Second, seasonality should be taken into account. The data for May and early June do not fully reflect the actual customer flow.</p> <p>Third, it appears important to indicate the type of each item (whether it is a medicinal product or not). We see that increasing the number of items in the receipt can significantly improve the Monetary metric without increasing visit frequency. Moreover, recommending non-medicinal products is far more promising than trying to sell a customer a medicinal product they do not need. At the moment, recommendations in this area can only be made based on the number of items in the receipt.</p>"},{"location":"rfm_finalize/#generous-customers","title":"Generous Customers","text":"Click to view the segment composition <p>RFM labels included in this segment: x30, x20, x31 (for all Recency values).</p> Size 334 Avg. Receipt 2391.88 Avg. Number of Items Purchased 4.64 <p>Return to the segment description in the Behavior &amp; Segmentation section.</p> <p>This group is characterized by a fairly high average receipt and a large number of items per purchase. However, most of these customers visited us only once. We see that they do not economize on medications and are willing to spend substantial amounts. </p> <p>Our task is to bring these customers back to the pharmacy for follow-up purchases in the near future.</p> <p>We can offer them</p> <ul> <li>a time-limited promotion (for example, for three months) with an increased discount rate on their loyalty card;</li> <li>introduce them to the extended assortment via email newsletters;</li> <li>if holidays are approaching, send special offers on cosmetics and/or dietary supplements;</li> <li>inform them about the locations of other pharmacy branches;</li> <li>propose a first-aid-box tailored for different situations, such as travel, visiting elderly relatives, or outdoor activities.</li> </ul>"},{"location":"rfm_finalize/#outstanding-customers","title":"Outstanding Customers","text":"Click to view the segment composition <p>RFM labels included in this segment: x00, x10, x21 (for all Recency values).</p> Size 389 Avg. Receipt 999.71 Avg. Number of Items Purchased 3.11 <p>Return to the segment description in the Behavior &amp; Segmentation section.</p> <p>This segment is characterized by regular pharmacy visits and a high average receipt. These are our key customers with high potential. They are willing to spend and demonstrate strong loyalty to the pharmacy. </p> <p>Our goal is to increase the number of items in their receipts by offering them a wider range of non-medical products.</p> <p>We can offer them</p> <ul> <li>special service options: providing a direct phone number to the pharmacy where they can check product availability and prices, accept orders by phone and prepare them in advance to reduce waiting time at the pharmacy;</li> <li>introduce them to the extended assortment via email newsletters;</li> <li>if holidays are approaching, send special offers on cosmetics and/or dietary supplements.</li> </ul>"},{"location":"rfm_finalize/#promising-customers","title":"Promising Customers","text":"Click to view the segment composition <p>RFM labels included in this segment: x32 (for all Recency values).</p> Size 203 Avg. Receipt 810.70 Avg. Number of Items Purchased 2.7 <p>Return to the segment description in the Behavior &amp; Segmentation section.</p> <p>These visitors came to us only once for a small set of products, but the total value of their purchase was high. We also see that their discount rate is among the highest (exceeded only by Pharmacy Friends). </p> <p>We would like these customers to return for a subsequent purchase.</p> <p>We can offer them</p> <ul> <li>an email newsletter highlighting discounts and bonuses on both the main and extended assortment;</li> <li>inform them about the locations of other pharmacy branches;</li> <li>a time-limited promotion with an increased discount rate on their loyalty card;</li> </ul>"},{"location":"rfm_finalize/#pharmacy-friends","title":"Pharmacy Friends","text":"Click to view the segment composition <p>RFM labels included in this segment: x01, x11, x22 (for all Recency values).</p> Size 217 Avg. Receipt 460.03 Avg. Number of Items Purchased 2.49 <p>Return to the segment description in the Behavior &amp; Segmentation section.</p> <p>This customer segment visits the pharmacy frequently, which results in a high Monetary value, but their average receipt is relatively low. They have high needs for regular pharmacy visits.</p> <p>With caution</p> <p>Care should be taken with general email campaigns for this group. They do not show interest in purchasing expensive products, and overly persistent offers through newsletters may annoy them. These customers are primarily willing to cover their (considerable) medical needs at the pharmacy.</p> <p>Our goal is to support their willingness to visit us while respecting their elevated needs.</p> <p>We can offer them</p> <ul> <li>a newsletter, excluding premium items (such as high-end cosmetics);</li> <li>including commonly used products available in supermarkets;</li> <li>highlighting special offers on medical devices (digital thermometers, blood pressure monitors, glucometers, etc.).</li> </ul>"},{"location":"rfm_finalize/#neighborhood-customers","title":"Neighborhood Customers","text":"Click to view the segment composition <p>RFM labels included in this segment: x12, x23, x13 (for all Recency values).</p> Size 213 Avg. Receipt 189.83 Avg. Number of Items Purchased 1.75 <p>Return to the segment description in the Behavior &amp; Segmentation section.</p> <p>These customers most likely find it convenient to visit this pharmacy; the majority of them came in no more than three weeks ago, and they probably do not have a consistent need for medicinal products. Special offers are unlikely to bring these customers back to the pharmacy. It may not even be worth bothering them with promotional messages.</p> <p>Our goal is to remain a convenient, easily accessible pharmacy for them.</p> <p>We can offer them</p> <ul> <li>SMS notifications, such as \"holiday opening hours.\"</li> </ul>"},{"location":"rfm_finalize/#interested-visitors","title":"Interested Visitors","text":"Click to view the segment composition <p>RFM labels included in this segment: x33 (for all Recency values).</p> Size 929 Avg. Receipt 276.20 Avg. Number of Items Purchased 1.98 <p>Return to the segment description in the Behavior &amp; Segmentation section.</p> <p>The last group is the largest, including more than one-third of all visitors, who came to us only once for a small purchase. We do not know their behavior when they need a larger quantity of medications. We can provide them with an extended promotional mailing in the hope that some of them will choose to return.</p> <p>Our task is to remind them that they have previously visited our pharmacy and that they are part of the loyalty program.</p> <p>We can offer them</p> <ul> <li>regular newsletters featuring both medical and non-medical products, branch locations, and information about the bonus program.</li> </ul>"},{"location":"unusual_behavior_overview/","title":"Unusual behaviour","text":""},{"location":"unusual_behavior_overview/#exploring-the-data","title":"Exploring the Data","text":"<p>Among valid barcodes, unusual behavior is sometimes observed. For example, it also happens that different barcodes are used within a single receipt. Let\u2019s take a look at one such receipt.</p> date time receipt item_number barcode discount_code drug_name 2022-05-15 17:21:31 1903 1 200010017048 9 \u0410\u041c\u0415\u041b\u041e\u0422\u0415\u041a\u0421 15\u041c\u0413. 2022-05-15 17:21:31 1903 2 200010017048 9 \u0412\u0410\u041b\u0421\u0410\u0420\u0422\u0410\u041d 80\u041c\u0413. 2022-05-15 17:21:31 1903 3 200000000042 939 \u041b\u0418\u041d\u041a\u041e\u041c\u0418\u0426\u0418\u041d 250\u041c <p>Barcode <code>200000000042</code> appears in 73 transactions across 8 different stores, whereas barcode <code>200010017048</code> appears only in these two transactions included in this receipt. We may assume that some barcodes (like \"the forty-second\" in the example receipt) might be used by pharmacy staff together with a customer\u2019s barcode. As we will see later, some barcodes appear an unusually high number of times.</p> <p>There are 41 receipts in which two barcodes are listed at the same time. There are 18 such barcodes in total.</p> Click to see the set of all these barcodes <p><code>200000000022</code>, <code>200000000492</code>, <code>200000000024</code>, <code>200010000015</code>, <code>200000000042</code>, <code>200010018869</code>, <code>200010027390</code>, <code>200010020351</code>, <code>200010007376</code>, <code>200010022634</code>, <code>200010000007</code>, <code>200010016458</code>, <code>200010001032</code>, <code>200010000888</code>, <code>200010000008</code>, <code>200010026840</code>, <code>200010013481</code>, <code>200010017048</code></p> <p>Some of them show typical activity, while others show patterns that do not align with the expected \"normal customer behavior.\"</p> <p>Before deciding how to handle these barcodes, let\u2019s look at the top performers in terms of the number of receipts.</p> <p></p> <p>Barcode <code>200000000022</code> accounts for more than a quarter of all receipts (and 2000 transactions totaling 1 529 558.10 RUB). The top six barcodes with the highest number of receipts together accumulate over half of all receipts. We should also pay attention to how many different stores these cards were used in. I would also assume that pharmacy employees might use certain barcodes to process orders placed, for example, by phone. </p> rank receipts barcode different_stores 1 2000 200000000022 1 2 1032 200000000492 7 3 527 200000000024 7 4 82 200010000015 8 5 73 200000000042 8 6 47 200000000044 6 <p>We highlight these first six barcodes. Barcodes with ranks 2 through 6 have fewer transactions, but purchases were made at different stores. For example, for the second barcode, <code>200000000492</code>, was active every day included in the dataset, there were 1032 transactions totaling 839 869.77 RUB, and transactions were conducted at multiple pharmacies on each working day:</p> num_active_days min_recipts_daily avg_recipts_daily max_recipts_daily min_dist_stores_daily 39 14 26.5 35 4 <p>Now, by combining these two issues \u2014 an excessively large number of transactions (6 barcodes) and the simultaneous appearance of two barcodes in a single receipt (18 cards) \u2014 we can cross-reference our lists of \"suspicious\" barcodes. Among the six cards, five also appear in the list of 18.</p> <p>The remaining top performing barcodes do not show either diversity of stores or an unusually high number of receipts (visiting a pharmacy every day, without additional factors, is not beyond what we might expect from a regular customer).</p>"},{"location":"unusual_behavior_overview/#our-actions","title":"Our Actions","text":"<p>We say that these 6 top performers are \"internal-use\" barcodes, and we exclude them from the analysis.</p>"},{"location":"unusual_behavior_overview/#sql-verification","title":"SQL Verification","text":"<p>You can check the GitHub repository to review the SQL queries used in this section.</p>"}]}